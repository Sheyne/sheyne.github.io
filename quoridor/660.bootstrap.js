"use strict";(self.webpackChunkquoridor=self.webpackChunkquoridor||[]).push([[660],{151:(e,t,s)=>{s.d(t,{Or:()=>L,lA:()=>y,r1:()=>w,t$:()=>C,tF:()=>f,ug:()=>b});var a=s(702);e=s.hmd(e);const o=new Array(32).fill(void 0);function n(e){return o[e]}o.push(void 0,null,!0,!1);let i=0,l=null;function r(){return null!==l&&l.buffer===a.memory.buffer||(l=new Uint8Array(a.memory.buffer)),l}let d=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const c="function"==typeof d.encodeInto?function(e,t){return d.encodeInto(e,t)}:function(e,t){const s=d.encode(e);return t.set(s),{read:e.length,written:s.length}};let h=null;function u(){return null!==h&&h.buffer===a.memory.buffer||(h=new Int32Array(a.memory.buffer)),h}let g=o.length;let p=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function m(e,t){return p.decode(r().subarray(e,e+t))}function v(e){g===o.length&&o.push(o.length+1);const t=g;return g=o[t],o[t]=e,t}p.decode(),Object.freeze({Up:0,0:"Up",Down:1,1:"Down",Left:2,2:"Left",Right:3,3:"Right"});const f=Object.freeze({Empty:0,0:"Empty",Horizontal:1,1:"Horizontal",Vertical:2,2:"Vertical"});Object.freeze({Horizontal:0,0:"Horizontal",Vertical:1,1:"Vertical"}),Object.freeze({Greedy:0,0:"Greedy",Rubot:1,1:"Rubot"});class y{static __wrap(e){const t=Object.create(y.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();a.__wbg_game_free(e)}constructor(){var e=a.game_new();return y.__wrap(e)}result(){var e=a.game_result(this.ptr);return 16777215===e?void 0:e}copy(){var e=a.game_copy(this.ptr);return y.__wrap(e)}current_player(){return a.game_current_player(this.ptr)}get_location(e){var t=a.game_get_location(this.ptr,e);return _.__wrap(t)}available_walls(e){return a.game_available_walls(this.ptr,e)}apply_move(e){return 0!==a.game_apply_move(this.ptr,v(e))}distance_to_goal(e){return a.game_distance_to_goal(this.ptr,e)}get_wall_status(e,t){return a.game_get_wall_status(this.ptr,e,t)>>>0}}class _{static __wrap(e){const t=Object.create(_.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();a.__wbg_location_free(e)}get x(){return a.__wbg_get_location_x(this.ptr)}set x(e){a.__wbg_set_location_x(this.ptr,e)}get y(){return a.__wbg_get_location_y(this.ptr)}set y(e){a.__wbg_set_location_y(this.ptr,e)}}const w=function(e,t){const s=n(t);var o=function(e,t,s){if(void 0===s){const s=d.encode(e),a=t(s.length);return r().subarray(a,a+s.length).set(s),i=s.length,a}let a=e.length,o=t(a);const n=r();let l=0;for(;l<a;l++){const t=e.charCodeAt(l);if(t>127)break;n[o+l]=t}if(l!==a){0!==l&&(e=e.slice(l)),o=s(o,a,a=l+3*e.length);const t=r().subarray(o+l,o+a);l+=c(e,t).written}return i=l,o}(JSON.stringify(void 0===s?null:s),a.__wbindgen_malloc,a.__wbindgen_realloc),l=i;u()[e/4+1]=l,u()[e/4+0]=o},b=function(e){!function(e){const t=n(e);(function(e){e<36||(o[e]=g,g=e)})(e)}(e)},C=function(e,t){return v(JSON.parse(m(e,t)))},L=function(e,t){throw new Error(m(e,t))}},660:(e,t,s)=>{s.r(t);var a=s(151);class o{getInfoForEvent(e,t,s,a){return"horizontal"==t&&((e.pageX-this.div.offsetLeft-e.target.offsetLeft)/e.target.offsetWidth<.5&&(s-=1),s<0&&(s=0),s>7&&(s=7)),"vertical"==t&&((e.pageY-this.div.offsetTop-e.target.offsetTop)/e.target.offsetHeight<.5&&(a-=1),a<0&&(a=0),a>7&&(a=7)),{kind:t,x:s,y:a}}click(e,t){this.onclick&&this.onclick(t,e)}mousemove(e,t){this.focused=t,this.render(this.lastGame)}mouseout(e,t){this.focused=null,this.render(this.lastGame)}constructor(e){this.div=document.createElement("div"),this.div.classList.add("quoridor-board-wrapper-wrapper");let t=document.createElement("div");t.classList.add("quoridor-board-wrapper"),this.div.appendChild(t);let s=document.createElement("div");s.classList.add("quoridor-board"),t.appendChild(s),s.addEventListener("click",(e=>{if(e.target&&e.target.data){let t=this.getInfoForEvent(e,e.target.data.kind,e.target.data.x,e.target.data.y),{kind:s,x:a,y:o}=t,n=null;"horizontal"==s&&(n={AddWall:{location:[a,o],orientation:"Horizontal"}}),"vertical"==s&&(n={AddWall:{location:[a,o],orientation:"Vertical"}}),"cell"==s&&(n={MoveTo:[a,o]}),null!=n&&this.onmove&&this.onmove(n)}})),s.addEventListener("mousemove",(e=>{if(e.target&&e.target.data){let t=this.getInfoForEvent(e,e.target.data.kind,e.target.data.x,e.target.data.y);this.mousemove(e,t)}})),s.addEventListener("mouseout",(e=>{if(e.target&&e.target.data){let t=this.getInfoForEvent(e,e.target.data.kind,e.target.data.x,e.target.data.y);this.mouseout(e,t)}})),this.cells=[],this.horizontal=[],this.vertical=[],this.joints=[];for(let e=0;e<=8;e++){let t,a=document.createElement("div");a.classList.add("quoridor-cell-row"),a.classList.add("quoridor-row"),8!=e&&(t=document.createElement("div"),t.classList.add("quoridor-wall-row"),t.classList.add("quoridor-row"));let o=[],n=[],i=[],l=[];for(let s=0;s<=8;s++){let r=document.createElement("div");if(r.classList.add("quoridor-cell"),r.data={kind:"cell",x:s,y:e},a.appendChild(r),o.push(r),8!=s){let t=this.createWall(!1);t.data={kind:"vertical",x:s,y:e},a.appendChild(t),n.push(t)}if(8!=e){let a=this.createWall(!0);if(a.data={kind:"horizontal",x:s,y:e},t.appendChild(a),i.push(a),8!=s){let a=document.createElement("div");a.classList.add("quoridor-wall"),a.classList.add("quoridor-joint"),a.data={kind:"joint",x:s,y:e},t.appendChild(a),l.push(a)}}}s.appendChild(a),8!=e&&s.appendChild(t),this.cells.push(o),this.vertical.push(n),this.horizontal.push(i),this.joints.push(l)}this.render(e)}createWall(e){let t=document.createElement("div");return t.classList.add("quoridor-wall"),e?t.classList.add("quoridor-horizontal"):t.classList.add("quoridor-vertical"),t}getCell(e,t){return this.cells[t][e]}getWall(e,t,s){return s?this.horizontal[t][e]:this.vertical[t][e]}getJoint(e,t){return this.joints[t][e]}render(e){this.lastGame&&this.lastGame!==e&&(this.lastGame.free(),this.lastGame=null),this.lastGame=e.copy();for(let e=0;e<=8;e++)for(let t=0;t<=8;t++)this.getCell(t,e).classList.remove("closed"),this.getCell(t,e).classList.remove("hover"),this.getCell(t,e).classList.remove("player1"),this.getCell(t,e).classList.remove("player2"),this.getCell(t,e).classList.remove("arrivable1"),this.getCell(t,e).classList.remove("arrivable2"),8!=e&&(this.getWall(t,e,!0).classList.remove("closed"),this.getWall(t,e,!0).classList.remove("hover")),8!=t&&(this.getWall(t,e,!1).classList.remove("closed"),this.getWall(t,e,!1).classList.remove("hover")),8!=e&&8!=t&&(this.getJoint(t,e).classList.remove("closed"),this.getJoint(t,e).classList.remove("hover"));for(let t=0;t<=8;t++)for(let s=0;s<=8;s++){let o=e.copy();o.apply_move({MoveTo:[s,t]})&&this.getCell(s,t).classList.add("arrivable"+e.current_player()),o.free(),o=null,e.get_wall_status(s,t)==a.tF.Horizontal&&(this.getWall(s,t,!0).classList.add("closed"),this.getJoint(s,t).classList.add("closed"),this.getWall(s+1,t,!0).classList.add("closed")),e.get_wall_status(s,t)==a.tF.Vertical&&(this.getWall(s,t,!1).classList.add("closed"),this.getJoint(s,t).classList.add("closed"),this.getWall(s,t+1,!1).classList.add("closed"))}if(this.focused){if("horizontal"==this.focused.kind){let t=this.focused.x,s=this.focused.y,a=e.copy();a.apply_move({AddWall:{location:[t,s],orientation:"Horizontal"}})&&(this.getWall(t,s,!0).classList.add("hover"),this.getJoint(t,s).classList.add("hover"),this.getWall(t+1,s,!0).classList.add("hover")),a.free(),a=null}if("vertical"==this.focused.kind){let t=this.focused.x,s=this.focused.y,a=e.copy();a.apply_move({AddWall:{location:[t,s],orientation:"Vertical"}})&&(this.getWall(t,s,!1).classList.add("hover"),this.getJoint(t,s).classList.add("hover"),this.getWall(t,s+1,!1).classList.add("hover")),a.free(),a=null}}this.getCell(e.get_location(1).x,e.get_location(1).y).classList.add("player1"),this.getCell(e.get_location(2).x,e.get_location(2).y).classList.add("player2")}}class n{constructor(){this.div=document.createElement("div"),this.div.classList.add("history"),this.states=[],this.selectedBoard=-1,document.addEventListener("keyup",(e=>{"ArrowUp"==e.code||"ArrowLeft"==e.code?this.selectBoard(this.selectedBoard-1):"ArrowDown"!=e.code&&"ArrowRight"!=e.code||this.selectBoard(this.selectedBoard+1)}))}selectedGame(){return this.states[this.selectedBoard].game.copy()}movesToSelected(){let e=[];for(let t=1;t<=this.selectedBoard;t++)e.push(this.states[t].move);return e}clearPastSelected(){for(let e of this.states.splice(this.selectedBoard+1))e.game.free(),this.div.removeChild(e)}isAtPresent(){return this.selectedBoard+1==this.states.length}selectBoard(e){e>=this.states.length||e<0||(this.selectedBoard>=0&&this.states[this.selectedBoard].classList.remove("selected"),this.selectedBoard=e,this.states[this.selectedBoard].classList.add("selected"),this.states[this.selectedBoard].scrollIntoView(),this.onselect&&this.onselect(this.states[this.selectedBoard].game,this.states[this.selectedBoard].index))}addBoard(e,t){let s=document.createElement("div");s.classList.add("history-entry");let a="???";t.MoveTo?a="Move to "+t.MoveTo[0]+", "+t.MoveTo[1]:null===t.InitialSetUp?a="Setup":t.AddWall&&(a="Add "+t.AddWall.orientation.toLowerCase()+" wall at "+t.AddWall.location[0]+", "+t.AddWall.location[1]),s.textContent=this.states.length+": "+a,s.index=this.states.length,s.game=e,s.move=t,s.addEventListener("click",(()=>this.selectBoard(s.index))),this.div.appendChild(s),this.states.push(s),this.selectedBoard+2==this.states.length&&this.selectBoard(this.selectedBoard+1)}}function i(){return new Worker(s.p+"bootstrap.worker.js")}class l{gotOnMessage(e){this.onmessage&&this.onmessage(e)}gotOnStateChange(e){this.onstatechange&&this.onstatechange(e)}gotDataChannel(e){console.log("gotDataChannel",e),this.channel=e.channel,this.channel.onopen=e=>this.gotChannelOpen(e),this.channel.onmessage=e=>this.gotOnMessage(e),this.ondatachannel&&this.ondatachannel(e)}gotChannelOpen(e){this.onopen&&this.onopen(e)}send(e){this.channel.send(e)}constructor(){this.connection=new RTCPeerConnection({iceTransportPolicy:"all",iceCandidatePoolSize:"0",iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]}),this.connection.onicecandidate=e=>this.gotIceCaandidate(e),this.connection.onsignalingstatechange=e=>this.gotOnStateChange(e),this.connection.onconnectionstatechange=e=>this.gotOnStateChange(e),this.icePromise=new Promise(((e,t)=>{this.connection.onicecandidate=t=>{null==t.candidate&&e()}}))}async serve(){this.kind="serve",this.gotDataChannel({channel:this.connection.createDataChannel("channel")});let e=await this.connection.createOffer();return this.connection.setLocalDescription(e),await this.icePromise,this.connection.localDescription}async connect(e){this.kind="client",this.connection.ondatachannel=e=>this.gotDataChannel(e),this.connection.setRemoteDescription(e);let t=await this.connection.createAnswer();return this.connection.setLocalDescription(t),await this.icePromise,this.connection.localDescription}}function r(e,t){try{let t=document.createElement("textarea"),s=document.createElement("button");s.textContent="Go",document.body.appendChild(t),document.body.appendChild(s);let a=new l;a.onopen=o=>{document.body.removeChild(t),document.body.removeChild(s),e(a)};let o="ready";s.onclick=async()=>{switch(o){case"ready":if(o="working",t.value){s.textContent="Working";let e=await a.connect(JSON.parse(t.value));t.value=JSON.stringify(e),s.textContent="Waiting"}else{let e=await a.serve();t.value=JSON.stringify(e),o="serving"}break;case"serving":o="working";let e=JSON.parse(t.value);a.connection.setRemoteDescription(e);break;default:console.log("Weird state: "+o)}}}catch(e){t(e)}}let d=document.createElement("button");d.textContent="Play Ai",document.body.appendChild(d);let c=document.createElement("button");c.textContent="Play Friend",document.body.appendChild(c),c.onclick=async()=>{document.body.removeChild(c),document.body.removeChild(d);let e=await new Promise(r);u="serve"==e.kind,h=u,e.onmessage=e=>p.onmessage(JSON.parse(e.data)),p.postMessage=t=>e.send(JSON.stringify(t)),p.onstart()},d.onclick=async()=>{g=!0,document.body.removeChild(c),document.body.removeChild(d);let e=document.createElement("input"),t=document.createElement("label");t.textContent="Difficulty: ",document.body.appendChild(t),e.type="range",e.min="0",e.max="4000",e.value="1500",e.addEventListener("change",(t=>s.postMessage({setMode:{rubot:Number(e.value)}}))),document.body.appendChild(e);let s=new i;s.onmessage=e=>p.onmessage(e.data),p.postMessage=e=>s.postMessage({move:e}),p.onstart()};let h=!0,u=!0,g=!1,p={onstart:function(){let e=null,t=new a.lA,s=new o(t),i=new n;i.addBoard(t.copy(),{InitialSetUp:null});let l=document.createElement("div");l.classList.add("play-area"),document.body.appendChild(l),l.appendChild(s.div),l.appendChild(i.div);let r=document.createElement("div"),d=document.createElement("button");d.textContent="Play Again",document.body.appendChild(r),document.body.appendChild(d),i.onselect=(e,t)=>{s.render(e)};let c=()=>{t=new a.lA,e=null,u=h,i.selectBoard(0),i.clearPastSelected()};d.addEventListener("click",(()=>{p.postMessage({Restart:!u}),c()}));let m=()=>{(e=t.result())?r.innerHTML="Player "+e+" wins":r.innerHTML="Player 1 has "+t.available_walls(1)+" walls left.<br/>Player 2 has "+t.available_walls(2)+" walls left.<br/>"};m(),p.onmessage=s=>{if(void 0!==s.Restart)c();else{if(u||e)return;t.apply_move(s),i.addBoard(t.copy(),s),m(),u=!0}},s.onmove=s=>{if(i.isAtPresent()){if(!u||e)return}else if(g){i.clearPastSelected();let e=i.movesToSelected();p.postMessage({StartAt:e}),t.free(),t=i.selectedGame()}else if(!u||e)return;t.apply_move(s)&&(i.addBoard(t.copy(),s),u=!1,p.postMessage(s),m())}}};switch(window.location.hash){case"#ai":d.onclick();break;case"#friend":c.onclick()}},702:(e,t,s)=>{var a=s.w[e.id];e.exports=a,s(151),a[""]()}}]);
//# sourceMappingURL=660.bootstrap.js.map